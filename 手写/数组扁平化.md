# 数组扁平化

> 例如：把 $[1, [2, [3, 4]]]$ 变成 $[1, 2, 3, 4]$


### $1.Array.prototype.flat()$ (es10)
``` JavaScript
const arr = [1, [2, [3, 4]]];
console.log(arr.flat()); // [1, 2, [3, 4]] ，默认只拍平一层

console.log(arr.flat(2)); // [1, 2, 3, 4] ，传参拍平几层

console.log(deepArr.flat(Infinity)); // [1, 2, 3, 4, 5] ，彻底拍平
```


### $2.递归$
> 可以看出是把数组中的元素一个一个 $push$ ，如果数组中是一个数组，同样把数组中数组的元素一个一个 $push$ ，这是一个规模更小的子问题，所以可以用递归来解决。
 
``` JavaScript
const flatten = (arr) => {
  let res = [];
  for (const item of arr) {
    if (Array.isArray(item)) {
      // 递归终点：数组中没有嵌套的数组，那么函数返回一个数组，使用 ... 来 push 拼接。
      res.push(...flatten(item));
      // 或者 res = res.concat(flatten(item));
    } else {
      res.push(item);
    }
  }
  return res;
}


// 优雅的一行
const flatten = (arr) => arr.reduce((pre, cur) => pre.concat(Array.isArray(cur) ? flatten(cur) : cur), []);


const arr = [1, [2, [3, [4]]]]
console.log(flatten(arr));  // [ 1, 2, 3, 4 ]
```

### $3.toString$
``` JavaScript
const arr = [1, [2, [3, 4]]];
const res = arr.toString().split(',').map(Number);  // [1, 2, 3, 4]
```
> 数组的 $toString$ 特性：当对一个数组调用 $toString()$ 时，它会自动把数组内**所有层级**的元素都取出来，并用逗号拼接成一个字符串。
`[1, [2, [3, 4]]].toString()` 会直接变成 `"1,2,3,4"` 。
重新分割：用 `split(',')` 把它切回数组：`["1", "2", "3", "4"]` 。
类型转换：因为切完后是字符串数组，所以最后用 `.map(Number)` 把它们转回数字。

> 局限性：$1.$ **数据类型丢失**： $toString$ 会把**所有**元素都变成**字符串**，如果原数组中既有数字也有字符串那么经过转换后将会无法区分。 $2.$ **无法处理特殊对象** ： 如果数组里包含 `undefined、null、对象或者函数` ，$toString()$ 之后它们会变成空`字符串或 "[object Object]"`